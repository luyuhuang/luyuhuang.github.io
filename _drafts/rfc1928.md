---
title: "[翻译] RFC 1928: SOCKS 协议第 5 版"
tag: translations
---
> socks5 是一个常用的代理协议, 它既可以用来代理 TCP, 也可以代理 UDP. socks5 的用途非常广泛, 许多网络软件都支持 socks5, 主流操作系统也支持使用 socks5 作系统代理. RFC 1928 是 socks5 协议的规范文档, 本文是对 RFC 1928 的翻译. 原文见 [RFC 1928 - SOCKS Protocol Version 5](https://tools.ietf.org/html/rfc1928). 以下是翻译正文:

### 文档声明

本文档为互联网社区规范了一个互联网标准跟踪的协议, 并征求讨论和改进建议. 请参阅当前版本的 "互联网官方协议标准(STD 1)" 以获取此协议的标准化的状态. 本文档的发布不受限制.

### 致谢

本文描述的协议是其之前版本 (第 4 版) 的升级版. 该协议离不开积极的讨论和原型的实现, 这其中主要的贡献者有: Marcus Leech: 贝尔北方研究中心, David Koblas: 独立顾问, Ying-Da Lee: NEC 系统实验室, LaMont Jones: 惠普公司, Ron Kuris: Unify 公司, Matt Ganis: IBM 公司.

## 1. 介绍

防火墙的使用变得越来越流行, 它可以有效地将组织内部网络与外部网络 (如因特网) 隔离. 这些防火墙系统通常充当网络这间的应用层网关, 通常提供 telnet, FTP 和 SMTP 的访问控制. 随着被设计成促进全球信息发现(global information discovery)的更复杂的应用层协议的出现, 我们需要一种通用的框架, 让这些协议可以透明安全地穿越防火墙.

此外, 我们还需要一种可操作的细粒度的方式对这种穿越防火墙的行为进行强认证. 这需要意识到, 客户端-服务器关系出现在各种组织的网络之间, 并且这种关系需要受到控制并经常经过严格的身份验证.

本文描述的协议旨在为TCP和UDP域中的客户端-服务器应用程序提供一个框架，以方便安全地使用网络防火墙的服务. 该协议在概念上是应用层和传输层之间的 "中介层", 因此无法提供网络层的网关服务, 例如转发 ICMP 消息.

## 2. 现有的实践

目前已有一个第 4 版的 SOCKS 协议, 可以为基于 TCP 的客户端-服务器应用提供非安全的防火墙穿透服务, 这其中包括 telnet, FTP 和一些流行的信息发现协议(information-discovery protocol)例如 HTTP, WAIS 和 GOPHER.

新协议将第 4 版 SOCKS 协议模型扩展为包括 UDP, 并扩展其框架使其包含通用强身份验证方案的规范, 此外寻址方案也扩展为包含域名和 IPv6.

SOCKS 协议的实现通常涉及到重新编译或重新链接基于 TCP 的客户端应用程序, 以使用 SOCKS 库中合适的封装例程.

### 注意:

除非另有说明, 出现在数据包格式图中的十进制数表示对应字段的长度, 单位为八位字节. 当一个给定的字节必须为一个特定的值时, 使用 `X'hh'` 的格式表示该字段中单字节的值. 当用到 "可变" 一词时, 表示对应字段的长度是由相应的长度字段 (一到两字节) 或数据类型字段所定义的可变长度.

## 3. 基于 TCP 客户端的过程

当一个基于 TCP 的客户端想要与一个必须经由防火墙 (取决于实现) 才能连接的对象建立连接时, 它必须在适当的端口开启一条到 SOCKS 服务器系统的 TCP 连接. SOCKS 服务通常使用 TCP 的 1080 端口. 如果连接请求成功, 客户端会进入协商阶段以协商认证方法, 然后使用所选的方法进行认证, 接着发送相应的请求. SOCKS 服务器会评估请求, 然后建立适当的连接或拒绝它.

除非另有说明, 出现在数据包格式图中的十进制数表示对应字段的长度, 单位为八位字节. 当一个给定的字节必须为一个特定的值时, 使用 `X'hh'` 的格式表示该字段中单字节的值. 当用到 "可变" 一词时, 表示对应字段的长度是由相应的长度字段 (一到两字节) 或数据类型字段所定义的可变长度.

> 译者注: 原文如此, 不知为何又重复了一段, 很奇怪.

客户端连接服务器, 然后发送一条包含版本号和方法选择的消息:

|VER | NMETHODS | METHODS  |
|:---|:---------|:---------|
| 1  |    1     | 1 至 255 |

`VER` 字段在这个版本置为 `X'05`. `NMETHODS` 字段包含出现在 `METHODS` 字段中的方法标识符的字节数.

服务器从 `METHODS` 字段中给出的方法中选择一个, 将其放在返回给客户端消息的 `METHOD` 字段中:

|VER | METHOD |
|:---|:-------|
| 1  |   1    |

如果 `METHOD` 字段标识选择的方法为 `X'FF'`, 则客户端列出的方法均不被服务器接受, 此时客户端必须关闭连接.

目前已定义的方法有:

- `X'00'` 无需认证
- `X'01'` GSSAPI
- `X'02'` 用户名/密码
- `X'03'` 至 `X'7F'` 由 IANA 分配
- `X'80'` 至 `X'FE'` 保留的私有方法
- `X'FF'` 没有可接受的方法

然后客户端和服务器会进入认证方法所规定的子协商过程(sub-negotiation).
